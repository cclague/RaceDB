{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}
{% load staticfiles %}

{% block javascript %}
	function sendEmail() {
		var email = document.getElementById("id_email");
		if( email && email.value.trim() ) {
			window.open('mailto:' + email.value.trim());
		}
		else
			alert( '{% trans "Missing Email!" %}' );
	}
{% endblock javascript %}

{% block onload %}
var uci_code = $('#id_uci_id');
uci_code.val( uci_code.val().replace(/(\d\d\d)/g, '$1 ') );

$("form").submit(function(event) {
		$('#id_license_code, #id_existing_tag, #id_existing_tag2, #tag, #tag2').each(
			function() { $(this).val( $(this).val().trim().replace(/^0+/, '') );
		});
		var uci_code = $('#id_uci_id');
		uci_code.val( uci_code.val().replace(/[^\d]/g, '') );
	});
{% endblock onload %}

{% block content %}
<h1>{{title}}</h1>
<hr/>
{% crispy form %}
<div style="text-align:center">
</div>
{% with participation=instance.get_participation_as_competitor %}
{% if instance.has_results %}
<hr/>
<a class="btn btn-primary hidden-print" target="_blank" href="/RaceDB/Hub/LicenseHolderResults/{{instance.id}}/">{% trans "Results Hub" %}</a>
{% endif %}
{% if participation %}
<hr/>
<h2>{% trans "Participation" %}</h2>
{% spaceless %}
<table class="table table-striped table-hover table-condensed">
<thead>
	<tr>
		<th></th>
		<th>{% trans "Date" %}</th>
		<th>{% trans "Category" %}</th>
		<th>{% trans "Team" %}</th>
		<th>{% trans "Competition" %}</th>
		<th>{% trans "Discipline" %}</th>
		<th>{% trans "Format" %}</th>
		<th>{% trans "Class" %}</th>
	</tr>
</thead>
<tbody>
	{% for p in participation %}
	<tr>
		<td class="text-right">{{forloop.counter}}.</td>
		<td>{{p.competition.date_range_year_str}}</td>
		<td>{% if p.category %}{{p.category.code}} ({{p.category.get_gender_display}}){% endif %}</td>
		<td>{{p.team.name}}</td>
		<td>{{p.competition.title}}</td>
		<td>{{p.competition.discipline.name}}</td>
		<td>{{p.competition.category_format.name}}</td>
		<td>{{p.competition.race_class.name}}</td>
	</tr>
	{% endfor %}
</tbody>
</table>
{% endspaceless %}
{% endif %}
{% endwith %}
{% endblock content %}
