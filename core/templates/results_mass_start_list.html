{% extends "base.html" %}

{% block content %}
{% load i18n %}
{% load static %}
{% load staticfiles %}
{% load crispy_forms_tags %}

<h2 class="hidden-print">{{title}}</h2>
<h2><strong>{{event.competition.name}}: {{event.name}}</strong>: {{event.date_time}}</h2>
{% trans "Generated" %}: {{time_stamp|date:"Y-m-d H:i:s"}}
<div class="hidden-print">
<hr/>
<a class="btn btn-primary" href="{{cancelUrl}}">{% trans "OK" %}</a>
&nbsp;&nbsp;&nbsp;&nbsp;
<button class="btn btn-primary" id="focus" onClick="window.print()"><img src="{% static "images/glyphicons_015_print.png" %}" >&nbsp;&nbsp;{% trans "Print" %}</button>
</div>
<h2 class="visible-print">{% trans "Waves" %}</h2>
{% spaceless %}
<table class="table table-striped table-hover">
<thead>
	<tr>
		<th>{% trans "Wave" %}</th>
		<th class="text-right">{% trans "Start Offset" %}</th>
		<th>{% trans "Details" %}</th>
		<th>{% trans "Categories" %}</th>
		<th class="text-center">{% trans "Reg" %}</th>
		<th class="text-center">{% trans "Strs" %}</th>
		<th class="text-center">{% trans "Nations" %}</th>
	</tr>
</thead>
<tbody>
	{% for w in event.wave_set.all %}
		<tr onclick="location.href='./#Wave{{forloop.counter}}'">
			<td>{{w.name}}</td>
			<td class="text-right">{{w.start_offset}}</td>
			<td>{{w.get_details_html|safe}}</td>
			<td>{% for cat, cnt in w.get_results_category_count %}
					&nbsp;<a class="btn btn-primary hidden-print" href="{{path}}ResultsMassStartCategory/{{event.id}}/{{cat.id}}">{{cat.code_gender}} ({{cnt}})</a>
				{% endfor %}
			</td>
			<td class="text-center">{{w.get_participant_count}}</td>
			<td class="text-center">{{w.get_results_num_starters}}</td>
			<td class="text-center">{{w.get_results_num_nationalities}}</td>
		</tr>
	{% endfor %}
</tbody>
</table>
{% endspaceless %}
<style>
	table.participant_table tr td {
		font-size: 75%;
	}
	table.participant_table tr th {
		font-size: 75%;
	}
</style>
{% for w in event.wave_set.all %}
<hr class="page-break-before"/>
<a name="Wave{{forloop.counter}}"></a>
<span class="visible-print">{{event.competition.name}}, {{event.name}}, {{event.date_time}}</span>
<h4>
	<strong style="font-size:125%">{{w.name}}</strong>: {% trans "Offset" %}: {{w.start_offset}}, {{w.get_details_html|safe}}, {% trans "Nations" %}: {{w.get_results_num_nationalities}}, {% trans "Strs" %}: {{w.get_results_num_starters}}
<br/>
</h4>
<h5 style="margin-top: 8px">{% trans "Categories" %}:
{% for cat, cnt in w.get_results_category_count %}
	&nbsp;<a class="btn btn-primary hidden-print" href="{{path}}ResultsMassStartCategory/{{event.id}}/{{cat.id}}">{{cat.code_gender}} ({{cnt}})</a>
{% endfor %}
</h5>
{% spaceless %}
<table class="table table-striped table-hover table-condensed participant_table">
<thead>
	<tr>
		<th class="text-right">{% trans "Rank" %}</th>
		<th class="text-right">{% trans "Bib" %}</th>
		<th>{% trans "Name" %}</th>
		<th>{% trans "Team" %}</th>
		<th>{% trans "Category" %}</th>
		<th>{% trans "License" %}</th>
		<th>{% trans "UCIID" %}</th>
		<th class="text-right">{% trans "Time" %}</th>
		<th class="text-right">{% trans "Gap" %}</th>
	</tr>
</thead>
<tbody>
	{% for rr in w.get_results %}
		{% with p=rr.participant h=rr.participant.license_holder %}
		<tr>
			<td class="text-right">{{rr.wave_rank_html}}</td>
			<td class="text-right">{{p.bib}}</td>
			<td>{{p.license_holder.full_name}}</td>
			<td>{% if p.team %}{{p.team.name}}{% endif %}</td>
			<td>{{p.category.code_gender}}</td>
			<td>{{h.license_code_trunc}}</td>
			<td>{{h.get_flag_uci_id_html}}</td>
			<td class="text-right">{{rr.adjusted_finish_time.format_no_decimals}}</td>
			<td class="text-right">{{rr.wave_gap}}</td>
		</tr>
		{% endwith %}
	{% endfor %}
</tbody>
</table>
{% endspaceless %}
{% endfor %}
{% endblock content %}
