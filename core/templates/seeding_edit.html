{% extends "base.html" %}

{% block content %}
{% load i18n %}
{% load staticfiles %}
{% load crispy_forms_tags %}
<style>
.adjustment {
	width: 50px;
}
.est_speed {
	width: 50px;
	text-align: right;
}
</style>

<h2 class="hidden-print">{{title}}</h2>
<h2><strong>{{instance.competition.name}}</strong></h2>
<h2><strong>{{instance.name}}</strong>: {{instance.date_time}}</h2>
<div class="hidden-print">
<hr/>
{% trans "Change the seeding by entering values in the Adjust field, then pressing the 'Apply Adjustments' button  (or press Enter)." %}<br/>
{% trans "Adjustment can be made relative to the current position by enter a number leading with +/-, or you can specify a new position by entering the number on its own." %}<br/>
{% trans "Examples" %}:
<p>
<ul>
<li>{% trans "Enter -2 to move a Participant two places earlier." %}</li>
<li>{% trans "Enter +3 to move a Participant three places later." %}</li>
<li>{% trans "Enter 11 to move a Participant to position 11." %}</li>
</ul>
</p>
{% trans "Remember to apply your changes with 'Apply Adjustments' (or press Enter)." %}
<hr/>
<form method="post" action=".">
{% csrf_token %}
{{ adjustment_formset.management_form }}
<button type="submit" name="apply_adjustments" class="btn btn-success">{% trans "Apply Adjustments" %}</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button type="submit" name="regenerate_start_times" class="btn btn-warning">{% trans "Regenerate Start Times" %}</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a class="btn btn-primary" href="{{cancelUrl}}">{% trans "OK" %}</a>
<hr/>
</div>
<h2 class="visible-print">{% trans "Waves" %}</h2>
{% spaceless %}
<table class="table table-striped table-hover">
<thead>
	<tr>
		<th>{% trans "Wave" %}</th>
		<th>{% trans "Categories" %}</th>
		<td>{% trans "Gap Rules" %}</td>
		<th class="text-center">{% trans "Strs" %}</th>
		{% if late_reg_exists %}<th class="text-center">{% trans "Late Reg" %}</th>{% endif %}
		<th class="hidden-print"></th>
	</tr>
</thead>
<tbody>
	{% for w in instance.wavett_set.all %}
		<tr onclick="jump('./WaveTTEdit/{{w.id}}/');">
			<td>{{w.name}}</td>
			<td>{{w.category_count_text}}</td>
			<td>{{w.gap_rules_text}}</td>
			<td class="text-center">{{w.get_participants_unsorted.count}}</td>
			{% if late_reg_exists %}<td class="text-center">{{w.get_late_reg.count}}</td>{% endif %}
			<td class="hidden-print">
				{% if request.user.is_superuser %}
					<a class="btn btn-success btn-xs" href="./WaveTTEdit/{{w.id}}/">{% trans "Edit" %}</a>
				{% endif %}
			</td>
		</tr>
	{% endfor %}
</tbody>
</table>
{% endspaceless %}
{% spaceless %}
<div class="hidden-print">
{% with duplicate_bibs=instance.get_duplicate_bibs %}
	{% if duplicate_bibs %}
		<hr/>
		<h2>{% trans "Duplicate Bib Numbers:" %}</h2>
		{% for db in duplicate_bibs %}
			{{db}}<br/>
		{% endfor %}
	{% endif %}
{% endwith %}
</div>
{% endspaceless %}
<style>
	table.participant_table tr td {
		font-size: 75%;
	}
	table.participant_table tr th {
		font-size: 75%;
	}
	.gap-change {
		border-top: 3px solid #000;
	}
</style>

<h2>{% trans "Start List" %}</h2>

{% spaceless %}
<table class="table table-striped table-hover table-condensed participant_table">
<thead>
	<tr>
		<th></th>
		<th class="text-right">{% trans "Clock" %}</th>
		<th class="text-right">{% trans "Stopwatch" %}</th>
		<th>{% trans "Bib" %}</th>
		<th>{% trans "Name" %}</th>
		<th>{% trans "Team" %}</th>
		<th>{% trans "Category" %}</th>
		<th>{% trans "Wave" %}</th>
		<th>{% trans "Est" %} {{instance.competition.speed_unit_display}}</th>
		<th>{% trans "Seed Early" %}</th>
		<th>{% trans "Adjust" %}</th>
	</tr>
</thead>
<tbody>
	{% for form in adjustment_formset %}
		{% with e=form.entry_tt w=form.wave p=form.entry_tt.participant h=form.entry_tt.participant.license_holder %}
		<tr {% if form.gap_change %}class="gap-change"{% endif %}>
			<td class="text-right">{{forloop.counter}}.</td>
			<td class="text-right">{{e.clock_time | time:"g:i:s a"}}</td>
			<td class="text-right">{{e.start_time}}</td>
			<td>{% if p.bib %}{{p.bib}}{% endif %}</td>
			<td>{{p.license_holder.full_name}}</td>
			<td>{% if p.team %}{{p.team.name}}{% endif %}</td>
			<td>{% if p.category %}{{p.category.code_gender}}{% endif %}</td>
			<td>{{w.name}}</td>
			<td>{{form.est_speed}}</td>
			<td>{{form.seed_early}}</td>
			<td>{{form.adjustment}}{{form.entry_tt_pk}}</td>
		</tr>
		{% endwith %}
	{% endfor %}
</tbody>
</table>
{% endspaceless %}
</form>
{% endblock content %}
